================================================================================
EXPLICACI√ìN DETALLADA DE app.py - Aplicaci√≥n Streamlit para Predicci√≥n de Ictus
================================================================================

¬øQU√â ES app.py?
===============
app.py es un script de Python que crea una interfaz web interactiva usando Streamlit.
Esta interfaz permite a los usuarios ingresar datos cl√≠nicos y obtener predicciones
sobre el riesgo de ictus usando un modelo de Machine Learning entrenado.

¬øC√ìMO EJECUTAR LA APP?
======================
1. Abre una terminal (PowerShell o CMD)
2. Ve a la carpeta del proyecto:
   cd C:\Users\USUARIO\Desktop\factoriaf5\p_final\AprendizajeSupervisado_Enrique

3. Ejecuta el comando:
   streamlit run app.py

4. Abre el navegador en: http://localhost:8501

================================================================================
DESGLOSE DEL C√ìDIGO L√çNEA POR L√çNEA
================================================================================

SECCI√ìN 1: IMPORTACIONES
========================
"""
import os
import joblib
import streamlit as st
import pandas as pd
import numpy as np
"""

Explicaci√≥n:
- import os              ‚Üí Permite trabajar con el sistema de archivos (buscar archivos)
- import joblib         ‚Üí Carga el modelo entrenado (modelo.pkl)
- import streamlit as st ‚Üí Crea la interfaz web
- import pandas as pd    ‚Üí Manejo de datos (aunque aqu√≠ no se usa mucho)
- import numpy as np     ‚Üí Operaciones con arrays num√©ricos (para crear arrays de features)


SECCI√ìN 2: CONFIGURACI√ìN DE LA P√ÅGINA
======================================
"""
st.set_page_config(page_title="Predicci√≥n de Ictus", layout="centered")
"""

Explicaci√≥n:
- st.set_page_config()  ‚Üí Configura la p√°gina de la app
- page_title            ‚Üí El t√≠tulo que aparece en la pesta√±a del navegador
- layout="centered"     ‚Üí Centra el contenido en la pantalla


SECCI√ìN 3: T√çTULO Y DESCRIPCI√ìN
================================
"""
st.title("üè• Predicci√≥n de Ictus")
st.write("""
Esta aplicaci√≥n utiliza un modelo de Machine Learning (Random Forest) 
entrenado en datos cl√≠nicos para predecir la probabilidad de ictus.
""")
"""

Explicaci√≥n:
- st.title()   ‚Üí Muestra un t√≠tulo grande en la p√°gina
- st.write()   ‚Üí Muestra texto descriptivo explicando qu√© hace la app
- El emoji üè• solo es decorativo


SECCI√ìN 4: VERIFICAR QUE EXISTE EL MODELO
===========================================
"""
if not os.path.exists("modelo.pkl"):
    st.error("""
    ‚ö†Ô∏è Archivo 'modelo.pkl' no encontrado.
    ...""")
    st.stop()
"""

Explicaci√≥n:
- os.path.exists()  ‚Üí Verifica si het archivo modelo.pkl existe en la carpeta
- if not           ‚Üí Si NO existe el archivo:
  - st.error()     ‚Üí Muestra un mensaje de error (en rojo)
  - st.stop()      ‚Üí Detiene la ejecuci√≥n de la app
  
IMPORTANTE: El modelo debe existir para que la app funcione.
Se crea ejecutando todas las celdas del notebook main.ipynb.


SECCI√ìN 5: CARGAR EL MODELO
============================
"""
try:
    model = joblib.load("modelo.pkl")
    st.success("‚úÖ Modelo cargado correctamente")
except Exception as e:
    st.error(f"‚ùå Error al cargar el modelo: {e}")
    st.stop()
"""

Explicaci√≥n:
- try/except       ‚Üí Manejo de errores (si algo falla, no se cuelga la app)
- joblib.load()    ‚Üí Carga el modelo guardado en modelo.pkl
- st.success()     ‚Üí Muestra un mensaje verde informando que todo va bien
- st.error()       ‚Üí Si hay error, muestra mensaje rojo


SECCI√ìN 6: CREAR FORMULARIO INTERACTIVO
========================================
"""
with st.form("prediction_form"):
    # C√≥digo aqu√≠ dentro va DENTRO del formulario
    submitted = st.form_submit_button("üîÆ Realizar Predicci√≥n")
"""

Explicaci√≥n:
- st.form()     ‚Üí Crea un formulario (agrupa campos de entrada)
- with          ‚Üí Todo lo indentado dentro pertenece al formulario
- form_submit_button() ‚Üí Bot√≥n que env√≠a el formulario


SECCI√ìN 7: CAMPOS DE ENTRADA - PARTE 1 (CL√çNICOS)
==================================================
"""
st.write("**Informaci√≥n Cl√≠nica y Demogr√°fica**")

col1, col2, col3 = st.columns(3)
with col1:
    age = st.number_input("Edad (a√±os)", min_value=0.0, max_value=120.0, value=50.0, step=1.0)
with col2:
    bmi = st.number_input("IMC (kg/m¬≤)", min_value=10.0, max_value=60.0, value=25.0, step=0.1)
with col3:
    glucose = st.number_input("Glucosa promedio", min_value=0.0, max_value=300.0, value=100.0, step=1.0)
"""

Explicaci√≥n:
- st.write()        ‚Üí Muestra un t√≠tulo para esta secci√≥n
- st.columns(3)     ‚Üí Divide la pantalla en 3 columnas
- with col1/col2/col3 ‚Üí Pone cada input en una columna diferente
- st.number_input() ‚Üí Campo num√©rico para ingresar n√∫meros
  - min_value      ‚Üí M√≠nimo valor permitido
  - max_value      ‚Üí M√°ximo valor permitido
  - value          ‚Üí Valor por defecto (lo que muestra al iniciar)
  - step           ‚Üí Incremento cuando uso las flechas

Las variables (age, bmi, glucose) guardan lo que el usuario ingresa.


SECCI√ìN 8: CAMPOS DE ENTRADA - PARTE 2 (CONDICIONES)
=====================================================
"""
col1, col2, col3 = st.columns(3)
with col1:
    hypertension = st.selectbox("¬øHipertensi√≥n?", [0, 1], 
                                format_func=lambda x: "No" if x == 0 else "S√≠")
with col2:
    heart_disease = st.selectbox("¬øEnfermedad card√≠aca?", [0, 1], 
                                 format_func=lambda x: "No" if x == 0 else "S√≠")
with col3:
    gender_male = st.selectbox("G√©nero", [0, 1], 
                               format_func=lambda x: "Femenino" if x == 0 else "Masculino")
"""

Explicaci√≥n:
- st.selectbox()    ‚Üí Dropdown (men√∫ desplegable)
- [0, 1]           ‚Üí Las opciones disponibles (0 = No, 1 = S√≠)
- format_func      ‚Üí Funci√≥n que cambia c√≥mo se ven las opciones
  - lambda x       ‚Üí Funci√≥n peque√±a que transforma x
  - if x == 0      ‚Üí Si es 0, muestra "No", si no muestra "S√≠"

El usuario ve "No" o "S√≠", pero internamente se guarda 0 o 1 (como lo espera el modelo).


SECCI√ìN 9: CAMPOS DE ENTRADA - PARTE 3 (TRABAJO Y ESTADO CIVIL)
===============================================================
"""
ever_married = st.selectbox("¬øAlguna vez casado?", [0, 1])
work_type = st.selectbox(
    "Tipo de trabajo",
    ["Govt_job", "Private", "Self-employed", "children"],
    format_func=lambda x: {"Govt_job": "Sector p√∫blico", "Private": "Privado", 
                           "Self-employed": "Aut√≥nomo", "children": "Dependiente"}[x]
)
"""

Explicaci√≥n:
- ever_married    ‚Üí Selectbox con 0 (No) o 1 (S√≠)
- work_type       ‚Üí Selectbox con 4 opciones (las que se ven corresponden a las etiquetas)
- format_func     ‚Üí Cambia c√≥mo se ve cada opci√≥n
  - {"Govt_job": "Sector p√∫blico", ...}[x] ‚Üí Busca en el diccionario y traduce


SECCI√ìN 10: CONSTRUIR EL ARRAY CON TODAS LAS FEATURES
======================================================
"""
work_type_private = 1 if work_type == "Private" else 0
work_type_self_employed = 1 if work_type == "Self-employed" else 0
work_type_children = 1 if work_type == "children" else 0

smoking_formerly = 1 if smoking_status == "formerly smoked" else 0
smoking_never = 1 if smoking_status == "never smoked" else 0
smoking_smokes = 1 if smoking_status == "smokes" else 0

input_data = np.array([[
    age,                      # Feature 1
    hypertension,             # Feature 2
    heart_disease,            # Feature 3
    glucose,                  # Feature 4
    bmi,                      # Feature 5
    gender_male,              # Feature 6
    ever_married,             # Feature 7
    work_type_private,        # Feature 8
    work_type_self_employed,  # Feature 9
    work_type_children,       # Feature 10
    residence_urban,          # Feature 11
    smoking_formerly,         # Feature 12
    smoking_never,            # Feature 13
    smoking_smokes            # Feature 14
]])
"""

Explicaci√≥n:
- Las l√≠neas if/else crean variables binarias (0 o 1):
  - Si work_type == "Private", entonces 1, si no 0
  - Esto convierte variables categ√≥ricas a formato one-hot (dummies)

- np.array([[...]]) crea un array NumPy con EXACTAMENTE 14 features
  - IMPORTANTE: El modelo espera estos 14 valores en este ORDEN exacto
  - Si faltan o est√°n en otro orden, el modelo falla


SECCI√ìN 11: REALIZAR LA PREDICCI√ìN
===================================
"""
prediction = model.predict(input_data)[0]
prediction_proba = model.predict_proba(input_data)[0]
"""

Explicaci√≥n:
- model.predict(input_data)      ‚Üí Le dice al modelo "predice con estos datos"
  - Devuelve [0] o [1] (sin riesgo o con riesgo)
  - [0] al final toma el primer elemento (porque devuelve un array)

- model.predict_proba(input_data) ‚Üí Probabilidades para ambas clases
  - Devuelve algo como [0.85, 0.15] = 85% sin riesgo, 15% con riesgo
  - [0] al final: toma solo estas probabilidades


SECCI√ìN 12: MOSTRAR RESULTADOS
===============================
"""
if prediction == 1:
    st.warning(f"‚ö†Ô∏è **Riesgo ALTO de Ictus** (Probabilidad: {prediction_proba[1]:.2%})")
else:
    st.success(f"‚úÖ **Riesgo BAJO de Ictus** (Probabilidad: {prediction_proba[1]:.2%})")

col1, col2 = st.columns(2)
with col1:
    st.metric("Sin Ictus", f"{prediction_proba[0]:.2%}")
with col2:
    st.metric("Con Ictus", f"{prediction_proba[1]:.2%}")
"""

Explicaci√≥n:
- if prediction == 1   ‚Üí Si el modelo predice riesgo alto (1)
  - st.warning()      ‚Üí Muestra en rojo/naranja
  - f"..."            ‚Üí f-string: inserta variables en el texto
  - {prediction_proba[1]:.2%} ‚Üí Muestra como porcentaje con 2 decimales

- else: si prediction == 0 (sin riesgo)
  - st.success()      ‚Üí Muestra en verde

- st.metric()         ‚Üí Muestra n√∫meros grandes y destacados
  - prediction_proba[0] ‚Üí Probabilidad de SIN ictus
  - prediction_proba[1] ‚Üí Probabilidad de CON ictus


SECCI√ìN 13: INFORMACI√ìN FINAL
==============================
"""
st.divider()
st.info("""
**‚ÑπÔ∏è Informaci√≥n Importante:**
- Este modelo fue entrenado con datos espec√≠ficos...
""")
"""

Explicaci√≥n:
- st.divider()  ‚Üí Dibuja una l√≠nea separadora
- st.info()     ‚Üí Muestra informaci√≥n en un recuadro azul


================================================================================
FLUJO COMPLETO DE LA APP
================================================================================

1. Usuario abre http://localhost:8501
   ‚Üì
2. App carga el modelo.pkl
   ‚Üì
3. App muestra el formulario con campos de entrada
   ‚Üì
4. Usuario completa todos los campos
   ‚Üì
5. Usuario hace clic en "üîÆ Realizar Predicci√≥n"
   ‚Üì
6. App convierte todos los datos a un array de 14 features
   ‚Üì
7. App env√≠a el array al modelo
   ‚Üì
8. Modelo devuelve predicci√≥n (0 o 1) y probabilidades
   ‚Üì
9. App muestra el resultado (Riesgo ALTO/BAJO) con porcentajes
   ‚Üì
10. Usuario puede cambiar valores y hacer otra predicci√≥n


================================================================================
RESUMEN R√ÅPIDO DE COMANDOS STREAMLIT
================================================================================

st.title()          ‚Üí T√≠tulo grande
st.write()          ‚Üí Texto normal
st.number_input()   ‚Üí Campo para n√∫meros
st.selectbox()      ‚Üí Men√∫ desplegable
st.columns()        ‚Üí Divide pantalla en columnas
st.form()           ‚Üí Crea un formulario
st.form_submit_button() ‚Üí Bot√≥n para enviar formulario
st.success()        ‚Üí Mensaje verde
st.error()          ‚Üí Mensaje rojo
st.warning()        ‚Üí Mensaje naranja
st.info()           ‚Üí Informaci√≥n en recuadro azul
st.metric()         ‚Üí N√∫mero grande destacado
st.divider()        ‚Üí L√≠nea separadora


================================================================================
¬øC√ìMO AGREGAR M√ÅS FEATURES?
================================================================================

1. Revisa en main.ipynb cu√°les son TODOS los features despu√©s de get_dummies()
2. Para cada nuevo feature, agrega en app.py:
   - Un campo de entrada (st.number_input o st.selectbox)
   - Una variable binaria (si es categ√≥rico)
   - Agrega la variable al array input_data en el orden correcto
3. IMPORTANTE: El orden y cantidad de features debe ser EXACTO al del modelo


================================================================================
FIN DE LA EXPLICACI√ìN
================================================================================
